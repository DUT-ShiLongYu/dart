PROJECT(freeimage-wrapper)

include(ExternalProject)

FUNCTION(INCLUDE_FREEIMAGE_VS MAINVER SUBVER PJEXT)
    SET_PROPERTY(GLOBAL PROPERTY USE_FOLDERS ON)

    SET(SUBPJS LibJPEG LibMNG LibPNG LibTIFF ZLib OpenEXR LibOpenJPEG LibRawLite)
    FOREACH(SUBPJ ${SUBPJS})
        INCLUDE_EXTERNAL_MSPROJECT(${SUBPJ} ${CMAKE_CURRENT_SOURCE_DIR}/Source/${SUBPJ}/${SUBPJ}.${SUBVER}.${PJEXT} )
    ENDFOREACH(SUBPJ)

    INCLUDE_EXTERNAL_MSPROJECT(FreeImage ${CMAKE_CURRENT_SOURCE_DIR}/FreeImage.${MAINVER}.${PJEXT} ${SUBPJS})
    #INCLUDE_EXTERNAL_MSPROJECT(FreeImageLib ${CMAKE_CURRENT_SOURCE_DIR}/Source/FreeImageLib/FreeImageLib.${SUBVER}.${PJEXT} ${SUBPJS} )

    #INCLUDE_EXTERNAL_MSPROJECT(FreeImagePlus ${CMAKE_CURRENT_SOURCE_DIR}/Wrapper/FreeImagePlus/FreeImagePlus.${SUBVER}.${PJEXT} FreeImage )

    SET_TARGET_PROPERTIES( FreeImage ${SUBPJS} # FreeImageLib FreeImagePlus
                           PROPERTIES FOLDER ThirdParty/FreeImage )
ENDFUNCTION(INCLUDE_FREEIMAGE_VS)

if(CMAKE_GENERATOR MATCHES "Visual Studio 7")
    INCLUDE_FREEIMAGE_VS(2003 2003 vcproj)
elseif(CMAKE_GENERATOR MATCHES "Visual Studio 8")
    INCLUDE_FREEIMAGE_VS(2005 2005 vcproj)
elseif(CMAKE_GENERATOR MATCHES "Visual Studio 9")
    INCLUDE_FREEIMAGE_VS(2008 2008 vcproj)
elseif(CMAKE_GENERATOR MATCHES "Visual Studio 10")
    INCLUDE_FREEIMAGE_VS(2010 2008 vcxproj)
else()
    ExternalProject_Add(
        freeimage-ext
        SOURCE_DIR ${CMAKE_CURRENT_SOURCE_DIR}
        CONFIGURE_COMMAND ""
    #	BUILD_COMMAND make
        BUILD_IN_SOURCE 1
        INSTALL_COMMAND ${CMAKE_COMMAND} -DINSTALL_PREFIX=${THIRDPARTY_INSTALL_PREFIX} -P ${CMAKE_CURRENT_SOURCE_DIR}/Install.cmake
        )
endif()


